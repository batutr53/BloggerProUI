@using BloggerProUI.Models.Post
@using BloggerProUI.Models.Category
@using BloggerProUI.Models.Tag
@using BloggerProUI.Models.Pagination
@using BloggerProUI.Models.Comment
@model PaginatedResultDto<PostListDto>

@{
    ViewData["Title"] = "Ana Sayfa";
}

<!-- Main Content -->
<main class="content-container">
    <!-- Featured Article Section -->
    <section class="featured-section">
        @if (Model?.Items?.Any() == true)
        {
            var featuredPost = Model.Items.FirstOrDefault();
            if (featuredPost != null)
            {
                <article class="featured-article">
                    <a href="@Url.Action("Detail", "Blog", new { slug = featuredPost.Slug })" style="text-decoration: none; color: inherit;">
                        <img src="@(string.IsNullOrEmpty(featuredPost.FeaturedImage) ? "https://images.unsplash.com/photo-1513475382585-d06e58bcb0e0?ixlib=rb-4.0.3&auto=format&fit=crop&w=435&q=80" : featuredPost.FeaturedImage)" alt="@featuredPost.Title" class="featured-image" loading="lazy">
                        <div class="featured-meta">@featuredPost.Categories?.FirstOrDefault()?.ToUpper() • @featuredPost.CreatedAt.ToString("dd MMMM yyyy")</div>
                        <h1 class="featured-title">@featuredPost.Title</h1>
                        <div class="featured-author">Yazan: @featuredPost.Author?.DisplayName?.ToUpper()</div>
                        <p class="featured-excerpt">
                            @Html.Raw(featuredPost.Content)
                        </p>
                    </a>
                </article>
            }
        }
     
        
        <aside class="sidebar">
            @if (Model?.Items?.Count() > 1)
            {
                @foreach (var sidebarPost in Model.Items.Skip(1).Take(3))
                {
                    <a href="@Url.Action("Detail", "Blog", new { slug = sidebarPost.Slug })" class="sidebar-article">
                        <img src="@(string.IsNullOrEmpty(sidebarPost.FeaturedImage) ? "https://images.unsplash.com/photo-1513475382585-d06e58bcb0e0?ixlib=rb-4.0.3&auto=format&fit=crop&w=435&q=80" : sidebarPost.FeaturedImage)" alt="@sidebarPost.Title" class="sidebar-image" loading="lazy">
                        <div class="sidebar-meta">@sidebarPost.Categories?.FirstOrDefault()?.ToUpper() • @sidebarPost.CreatedAt.ToString("dd MMMM yyyy")</div>
                        <h3 class="sidebar-title">@sidebarPost.Title</h3>
                        <div class="sidebar-author">Yazan: @sidebarPost.Author?.DisplayName?.ToUpper()</div>
                        <p class="sidebar-excerpt">
                            @(sidebarPost.Excerpt?.Length > 100 ? sidebarPost.Excerpt.Substring(0, 100) + "..." : sidebarPost.Excerpt)
                        </p>
                    </a>
                }
            }
        
        </aside>
    </section>

    <!-- Today's Trending Section -->
    <section>
        <div class="section-header">
            <h2 class="section-title">Bugünün Öne Çıkanları</h2>
            <a href="@Url.Action("Index", "Blog")" class="view-all">Tümünü Gör</a>
        </div>
        
        <div class="trending-grid">
            @if (ViewBag.FeaturedPosts != null)
            {
                var featuredPosts = ViewBag.FeaturedPosts as List<PostListDto>;
                if (featuredPosts != null && featuredPosts.Any())
                {
                    @foreach (var trendingPost in featuredPosts)
                    {
                        <a href="@Url.Action("Detail", "Blog", new { slug = trendingPost.Slug })" class="trending-item">
                            <img src="@(string.IsNullOrEmpty(trendingPost.FeaturedImage) ? "https://images.unsplash.com/photo-1502920917128-1aa500764cbd?ixlib=rb-4.0.3&auto=format&fit=crop&w=435&q=80" : trendingPost.FeaturedImage)" alt="@trendingPost.Title" class="trending-image" loading="lazy">
                            <div class="trending-meta">@trendingPost.Categories?.FirstOrDefault()?.ToUpper() • @trendingPost.CreatedAt.ToString("dd MMMM yyyy")</div>
                            <h3 class="trending-title">@trendingPost.Title</h3>
                            <div class="trending-author">Yazan: @trendingPost.Author?.DisplayName?.ToUpper()</div>
                        </a>
                    }
                }
            }
         
        </div>
    </section>

    <!-- Latest Articles Section -->
    <section>
        
        <div class="latest-layout">
            <div class="articles-left">
                @if (Model?.Items?.Count() > 7)
                {
                    @foreach (var latestPost in Model.Items.Skip(7).Take(3))
                    {
                        <a href="@Url.Action("Detail", "Blog", new { slug = latestPost.Slug })" class="article-item">
                            <img src="@(string.IsNullOrEmpty(latestPost.FeaturedImage) ? "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=387&q=80" : latestPost.FeaturedImage)" alt="@latestPost.Title" class="article-image" loading="lazy">
                            <div class="article-content">
                                <div class="article-meta">@latestPost.Categories?.FirstOrDefault()?.ToUpper() • @latestPost.CreatedAt.ToString("dd MMMM yyyy")</div>
                                <h3 class="article-title">@latestPost.Title</h3>
                                <div class="article-author">Yazan: @latestPost.Author?.DisplayName?.ToUpper()</div>
                                <p class="article-excerpt">
                                    @(latestPost.Excerpt?.Length > 150 ? latestPost.Excerpt.Substring(0, 150) + "..." : latestPost.Excerpt)
                                </p>
                            </div>
                        </a>
                    }
                }
           
            </div>
          
        </div>
    </section>

    <!-- Latest Comments Section -->
    <section>
        <div class="section-header">
            <h2 class="section-title">Son Yorumlar</h2>
            <a href="@Url.Action("Index", "Blog")" class="view-all">Tümünü Gör</a>
        </div>
        
        <div class="articles-left">
            @if (ViewBag.RecentComments != null)
            {
                var recentComments = ViewBag.RecentComments as List<BloggerProUI.Models.Comment.RecentCommentDto>;
                if (recentComments != null && recentComments.Any())
                {
                    @foreach (var comment in recentComments)
                    {
                        <div class="podcast-item">
                            <div class="podcast-image">
                                <a href="@Url.Action("Detail", "Blog", new { slug = comment.Post.Slug })">
                                    <img src="@(string.IsNullOrEmpty(comment.Post.ImageUrl) ? "https://images.unsplash.com/photo-1513475382585-d06e58bcb0e0?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" : comment.Post.ImageUrl)" 
                                         alt="@comment.Post.Title" 
                                         loading="lazy"
                                         onerror="this.src='https://images.unsplash.com/photo-1513475382585-d06e58bcb0e0?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80'; this.onerror=null;">
                                </a>
                            </div>
                            <div class="podcast-content">
                                <h3 class="podcast-title">
                                    <a href="@Url.Action("Detail", "Blog", new { slug = comment.Post.Slug })">
                                        @comment.Post.Title
                                    </a>
                                </h3>
                                <div class="podcast-meta">
                                    @comment.UserName • @comment.CreatedAt.ToString("dd MMMM yyyy")
                                </div>
                                <p class="podcast-description">
                                    @(comment.Content.Length > 120 ? comment.Content.Substring(0, 120) + "..." : comment.Content)
                                </p>
                            </div>
                        </div>
                    }
                }
             
            }

        </div>
    </section>
</main>



@if (Model?.TotalPages > 1)
{
    <div class="pagination-container" style="text-align: center; margin: 40px 0;">
        <div class="pagination">
            @if (Model.PageNumber > 1)
            {
                <a href="@Url.Action("Index", new { page = Model.PageNumber - 1, pageSize = Model.PageSize })" class="pagination-btn">← Önceki</a>
            }
            
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                if (i == Model.PageNumber)
                {
                    <span class="pagination-current">@i</span>
                }
                else
                {
                    <a href="@Url.Action("Index", new { page = i, pageSize = Model.PageSize })" class="pagination-btn">@i</a>
                }
            }
            
            @if (Model.PageNumber < Model.TotalPages)
            {
                <a href="@Url.Action("Index", new { page = Model.PageNumber + 1, pageSize = Model.PageSize })" class="pagination-btn">Sonraki →</a>
            }
        </div>
    </div>
}