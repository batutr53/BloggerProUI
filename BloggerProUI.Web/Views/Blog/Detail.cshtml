@model BloggerProUI.Models.Post.PostDetailDto
@{
    ViewData["Title"] = Model?.Title ?? "Blog Detayƒ±";
}

@if (Model == null)
{
    <main class="content-container" style="text-align: center; padding: 60px 20px;">
        <h1>Yazƒ± Bulunamadƒ±</h1>
        <p>Aradƒ±ƒüƒ±nƒ±z blog yazƒ±sƒ± bulunamadƒ± veya kaldƒ±rƒ±lmƒ±≈ü olabilir.</p>
        <div style="margin-top: 30px;">
            <a href="@Url.Action("Index", "Blog")" class="btn" style="background: #333; color: #fff; padding: 12px 24px; text-decoration: none; border-radius: 4px;">
                T√ºm Yazƒ±lara D√∂n
            </a>
        </div>
    </main>
}
else
{

<!-- Main Article Container -->
<main class="article-container">
    <!-- Article Content -->
    <article class="article-content">
        <!-- Article Header -->
        <header class="article-header">
            <div class="article-meta">
                @if (Model?.Categories != null && Model.Categories.Any())
                {
                    @string.Join(", ", Model.Categories).ToUpper()
                }
                else
                {
                    <text>GENEL</text>
                }
                ¬∑ @(Model?.PublishDate?.ToString("dd MMMM yyyy", new System.Globalization.CultureInfo("tr-TR")) ?? Model?.CreatedAt.ToString("dd MMMM yyyy", new System.Globalization.CultureInfo("tr-TR")) ?? DateTime.Now.ToString("dd MMMM yyyy", new System.Globalization.CultureInfo("tr-TR")))
            </div>
            <h1 class="article-title">@(Model?.Title ?? "Blog Yazƒ±sƒ±")</h1>
            <div class="article-author">Yazan: @(Model?.AuthorName?.ToUpper() ?? "Bƒ∞Lƒ∞NMEYEN")</div>
            
            @if (Model != null)
            {
                <div class="article-stats" style="margin-top: 15px; color: #999; font-size: 14px; display: flex; gap: 20px;">
                    <span title="G√∂r√ºnt√ºlenme sayƒ±sƒ±">üëÅ @Model.ViewCount</span>
                    <span title="Beƒüeni sayƒ±sƒ±">‚ù§Ô∏è @Model.LikeCount</span>
                    <span title="Yorum sayƒ±sƒ±">üí¨ @Model.CommentCount</span>
                    @if (Model.AverageRating.HasValue && Model.AverageRating > 0)
                    {
                        <span title="Ortalama puan">‚≠ê @Model.AverageRating.Value.ToString("F1")</span>
                    }
                </div>
            }
        </header>

        <!-- Main Article Image -->
        @if (!string.IsNullOrEmpty(Model?.FeaturedImage))
        {
            <img src="@Model.FeaturedImage" alt="@Model.Title" class="article-image" loading="lazy">
            <div class="image-caption">
                @Model.Title
            </div>
        }
        else
        {
            <img src="https://images.unsplash.com/photo-1494790108755-2616c9a7aaa0?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80" alt="@(Model?.Title ?? "Blog Yazƒ±sƒ±")" class="article-image" loading="lazy">
            <div class="image-caption">
                @(Model?.Title ?? "Blog Yazƒ±sƒ±")
            </div>
        }

        <!-- Article Text -->
        <div class="article-text">
            @if (!string.IsNullOrEmpty(Model?.Content))
            {
                @Html.Raw(Model.Content)
            }
            else if (!string.IsNullOrEmpty(Model?.Excerpt))
            {
                <p>@Model.Excerpt</p>
            }
            else
            {
                <div class="no-content" style="text-align: center; padding: 40px 20px; color: #666;">
                    <h3>ƒ∞√ßerik bulunamadƒ±</h3>
                    <p>Bu yazƒ±nƒ±n i√ßeriƒüi hen√ºz y√ºklenmemi≈ü veya mevcut deƒüil.</p>
                </div>
            }
        </div>

        <!-- Post Modules (Dynamic Content) -->
        @if (Model?.Modules != null && Model.Modules.Any())
        {
            @foreach (var module in Model.Modules.OrderBy(m => m.SortOrder))
            {
                @switch (module.Type)
                {
                    case BloggerProUI.Models.Enums.PostModuleType.Paragraph:
                        <div class="article-text">
                            @if (!string.IsNullOrEmpty(module.Content))
                            {
                                @Html.Raw(module.Content)
                            }
                        </div>
                        break;

                    case BloggerProUI.Models.Enums.PostModuleType.Heading:
                        <div class="article-heading" style="margin: 30px 0 20px 0;">
                            @if (!string.IsNullOrEmpty(module.Content))
                            {
                                <h2 style="font-size: 28px; font-weight: 600; color: #333;">@Html.Raw(module.Content)</h2>
                            }
                        </div>
                        break;

                    case BloggerProUI.Models.Enums.PostModuleType.Image:
                        <div class="content-with-image" style="margin: 30px 0;">
                            @if (!string.IsNullOrEmpty(module.MediaUrl))
                            {
                                <img src="@module.MediaUrl" alt="@(Model.Title)" class="content-image" loading="lazy">
                            }
                            @if (!string.IsNullOrEmpty(module.Content))
                            {
                                <div class="image-caption" style="margin-top: 10px; color: #666; font-size: 14px; text-align: center;">
                                    @Html.Raw(module.Content)
                                </div>
                            }
                        </div>
                        break;

                    case BloggerProUI.Models.Enums.PostModuleType.Quote:
                        <blockquote class="article-quote" style="margin: 30px 0; padding: 20px 30px; border-left: 4px solid #333; background: #f9f9f9; font-style: italic; font-size: 18px;">
                            @if (!string.IsNullOrEmpty(module.Content))
                            {
                                @Html.Raw(module.Content)
                            }
                        </blockquote>
                        break;

                    case BloggerProUI.Models.Enums.PostModuleType.Video:
                        <div class="video-container" style="margin: 30px 0; text-align: center;">
                            @if (!string.IsNullOrEmpty(module.MediaUrl))
                            {
                                <video controls style="max-width: 100%; height: auto; border-radius: 8px;">
                                    <source src="@module.MediaUrl" type="video/mp4">
                                    Tarayƒ±cƒ±nƒ±z video oynatmayƒ± desteklemiyor.
                                </video>
                            }
                            @if (!string.IsNullOrEmpty(module.Content))
                            {
                                <div class="video-caption" style="margin-top: 10px; color: #666; font-size: 14px;">
                                    @Html.Raw(module.Content)
                                </div>
                            }
                        </div>
                        break;

                    case BloggerProUI.Models.Enums.PostModuleType.IFrame:
                        <div class="iframe-container" style="margin: 30px 0;">
                            @if (!string.IsNullOrEmpty(module.MediaUrl))
                            {
                                <iframe src="@module.MediaUrl" style="width: 100%; height: 400px; border: none; border-radius: 8px;" loading="lazy"></iframe>
                            }
                            @if (!string.IsNullOrEmpty(module.Content))
                            {
                                <div class="iframe-caption" style="margin-top: 10px; color: #666; font-size: 14px; text-align: center;">
                                    @Html.Raw(module.Content)
                                </div>
                            }
                        </div>
                        break;

                    default:
                        <div class="custom-module" style="margin: 20px 0;">
                            @if (!string.IsNullOrEmpty(module.Content))
                            {
                                @Html.Raw(module.Content)
                            }
                        </div>
                        break;
                }
            }
        }

        <!-- Share Section -->
        <div class="share-section">
            <h3 class="share-title">Bu makaleyi payla≈ü</h3>
            <div class="share-buttons">
                <a href="https://twitter.com/intent/tweet?text=@(Uri.EscapeDataString(Model?.Title ?? "BloggerPro"))&url=@(Uri.EscapeDataString(Context.Request.Scheme + "://" + Context.Request.Host + Context.Request.Path))" 
                   target="_blank" class="share-btn" data-platform="twitter"><i class="fab fa-twitter"></i></a>
                <a href="https://www.facebook.com/sharer/sharer.php?u=@(Uri.EscapeDataString(Context.Request.Scheme + "://" + Context.Request.Host + Context.Request.Path))" 
                   target="_blank" class="share-btn" data-platform="facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url=@(Uri.EscapeDataString(Context.Request.Scheme + "://" + Context.Request.Host + Context.Request.Path))" 
                   target="_blank" class="share-btn" data-platform="linkedin"><i class="fab fa-linkedin-in"></i></a>
                <a href="#" class="share-btn" onclick="copyToClipboard('@(Context.Request.Scheme)://@(Context.Request.Host)@(Context.Request.Path)'); return false;"><i class="fas fa-link"></i></a>
            </div>
        </div>

        <!-- Post Interaction -->
        @if (Model != null)
        {
            <div class="post-interaction" style="margin: 30px 0; padding: 20px; background: #f9f9f9; border-radius: 8px;">
                <div class="interaction-stats" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div class="stats-left">
                        <span style="margin-right: 20px;">üëÅ @Model.ViewCount g√∂r√ºnt√ºlenme</span>
                        <span style="margin-right: 20px;">‚ù§Ô∏è @Model.LikeCount beƒüeni</span>
                        <span>üí¨ @Model.CommentCount yorum</span>
                    </div>
                    @if (Model.AverageRating.HasValue && Model.AverageRating > 0)
                    {
                        <div class="rating-display">
                            <span>‚≠ê @Model.AverageRating.Value.ToString("F1")</span>
                        </div>
                    }
                </div>
                
                <div class="interaction-buttons" style="display: flex; gap: 10px;">
                    <button class="like-btn @(Model.IsLikedByCurrentUser == true ? "liked" : "")" 
                            onclick="toggleLike('@Model.Id')" 
                            style="background: @(Model.IsLikedByCurrentUser == true ? "#e74c3c" : "#fff"); color: @(Model.IsLikedByCurrentUser == true ? "#fff" : "#333"); border: 2px solid #e74c3c; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                        ‚ù§Ô∏è @(Model.IsLikedByCurrentUser == true ? "Beƒüenildi" : "Beƒüen")
                    </button>
                    
                    @if (Model.AllowComments)
                    {
                        <button onclick="scrollToComments()" style="background: #fff; color: #333; border: 2px solid #333; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                            üí¨ Yorum Yap
                        </button>
                    }
                </div>
            </div>
        }

        <!-- Tags -->
        <div class="tags-section">
            <h3 class="section-title">Etiketler</h3>
            <div class="tags">
                @if (Model?.Tags != null && Model.Tags.Any())
                {
                    @foreach (var tag in Model.Tags)
                    {
                        <a href="#" class="tag">@tag</a>
                    }
                }
                else
                {
                    <span class="tag" style="background: #f0f0f0; color: #999;">Etiket bulunmuyor</span>
                }
            </div>
        </div>

        <!-- Author Box -->
        <div class="author-box">
            <div class="author-info">
                <img src="@(!string.IsNullOrEmpty(Model?.AuthorAvatar) ? Model.AuthorAvatar : "https://images.unsplash.com/photo-1494790108755-2616c9a7aaa0?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80")" 
                     alt="@(Model?.AuthorName ?? "Yazar")" class="author-avatar" loading="lazy">
                <div class="author-details">
                    <h4>@(Model?.AuthorName ?? "Bilinmeyen Yazar")</h4>
                    <p>
                        @if (!string.IsNullOrEmpty(Model?.AuthorName))
                        {
                            <text>@Model.AuthorName tarafƒ±ndan yazƒ±lmƒ±≈ü makaleler ve g√∂r√º≈üler.</text>
                        }
                        else
                        {
                            <text>BloggerPro ekibinden kaliteli i√ßerikler.</text>
                        }
                    </p>
                    @if (Model != null)
                    {
                        <div class="author-stats" style="margin-top: 10px; font-size: 14px; color: #666;">
                            <span>Yayƒ±n Tarihi: @(Model.PublishDate?.ToString("dd MMMM yyyy", new System.Globalization.CultureInfo("tr-TR")) ?? Model.CreatedAt.ToString("dd MMMM yyyy", new System.Globalization.CultureInfo("tr-TR")))</span>
                            @if (Model.LastModified.HasValue)
                            {
                                <br><span>Son G√ºncelleme: @Model.LastModified.Value.ToString("dd MMMM yyyy", new System.Globalization.CultureInfo("tr-TR"))</span>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </article>

    <!-- Sidebar -->
    <aside class="sidebar">
        <!-- Related Articles -->
        <div class="sidebar-section">
            <h3 class="sidebar-title">ƒ∞lgili Yazƒ±lar</h3>
            
            <a href="#" class="related-article">
                <img src="https://images.unsplash.com/photo-1502920917128-1aa500764cbd?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" alt="Related Article" class="related-image" loading="lazy">
                <div class="related-meta">FOTOƒûRAF ¬∑ 12 Ocak 2025</div>
                <h4 class="related-title">Richard Avedon'un Moda Fotoƒüraf√ßƒ±lƒ±ƒüƒ±ndaki Devrimi</h4>
                <div class="related-author">Yazan: JOHN DOE</div>
            </a>
            
            <a href="@Url.Action("Index", "Home")" class="related-article">
                <img src="https://images.unsplash.com/photo-1556075798-4825dfaaf498?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" alt="Related Article" class="related-image" loading="lazy">
                <div class="related-meta">ANA SAYFA</div>
                <h4 class="related-title">Ana Sayfaya D√∂n</h4>
                <div class="related-author">Daha fazla i√ßerik ke≈üfet</div>
            </a>
            
            <a href="@Url.Action("Index", "Blog")" class="related-article">
                <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" alt="Related Article" class="related-image" loading="lazy">
                <div class="related-meta">BLOG</div>
                <h4 class="related-title">T√ºm Blog Yazƒ±larƒ±</h4>
                <div class="related-author">Daha fazla makale oku</div>
            </a>
        </div>

        <!-- Newsletter Signup -->
        <div class="sidebar-section">
            <div class="newsletter-sidebar">
                <h3 class="newsletter-sidebar-title">E-B√ºlten</h3>
                <p class="newsletter-sidebar-text">
                    Sanat ve fotoƒüraf√ßƒ±lƒ±k d√ºnyasƒ±ndan en g√ºncel haberleri ka√ßƒ±rmayƒ±n.
                </p>
                <div class="newsletter-sidebar-input">
                    <input type="email" placeholder="E-posta adresiniz">
                </div>
                <button class="newsletter-sidebar-btn">Abone Ol</button>
            </div>
        </div>

        <!-- Popular Tags -->
        <div class="sidebar-section">
            <h3 class="sidebar-title">Pop√ºler Etiketler</h3>
            <div class="tags">
                <a href="#" class="tag">Fotoƒüraf√ßƒ±lƒ±k</a>
                <a href="#" class="tag">Moda</a>
                <a href="#" class="tag">Sanat</a>
                <a href="#" class="tag">Portre</a>
                <a href="#" class="tag">Siyah-Beyaz</a>
                <a href="#" class="tag">Tasarƒ±m</a>
                <a href="#" class="tag">Mimari</a>
                <a href="#" class="tag">Street Photography</a>
            </div>
        </div>
    </aside>
</main>

<script>
// Copy to clipboard function
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        alert('Link panoya kopyalandƒ±!');
    }, function(err) {
        console.error('Panoya kopyalama hatasƒ±: ', err);
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('Link panoya kopyalandƒ±!');
    });
}

// Like/Unlike function
async function toggleLike(postId) {
    try {
        const likeBtn = document.querySelector('.like-btn');
        const isCurrentlyLiked = likeBtn.classList.contains('liked');
        
        // Optimistic UI update
        if (isCurrentlyLiked) {
            likeBtn.classList.remove('liked');
            likeBtn.innerHTML = '‚ù§Ô∏è Beƒüen';
            likeBtn.style.background = '#fff';
            likeBtn.style.color = '#333';
        } else {
            likeBtn.classList.add('liked');
            likeBtn.innerHTML = '‚ù§Ô∏è Beƒüenildi';
            likeBtn.style.background = '#e74c3c';
            likeBtn.style.color = '#fff';
        }
        
        // Here you would make an API call to toggle the like
        // const response = await fetch(`/api/posts/${postId}/like`, { method: 'POST' });
        // if (!response.ok) {
        //     // Revert the UI changes if the API call failed
        //     location.reload();
        // }
        
        console.log(`Toggle like for post: ${postId}`);
    } catch (error) {
        console.error('Like i≈ülemi hatasƒ±:', error);
        // Revert UI changes on error
        location.reload();
    }
}

// Scroll to comments function
function scrollToComments() {
    // This would scroll to a comments section if it exists
    const commentsSection = document.getElementById('comments-section');
    if (commentsSection) {
        commentsSection.scrollIntoView({ behavior: 'smooth' });
    } else {
        alert('Yorum b√∂l√ºm√º bu sayfada mevcut deƒüil.');
    }
}

// Image zoom functionality
document.addEventListener('DOMContentLoaded', function() {
    const images = document.querySelectorAll('.article-image, .content-image');
    images.forEach(img => {
        img.style.cursor = 'zoom-in';
        img.addEventListener('click', function() {
            // Simple image zoom modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                cursor: zoom-out;
            `;
            
            const modalImg = document.createElement('img');
            modalImg.src = this.src;
            modalImg.style.cssText = `
                max-width: 90%;
                max-height: 90%;
                object-fit: contain;
            `;
            
            modal.appendChild(modalImg);
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function() {
                document.body.removeChild(modal);
            });
        });
    });
});
</script>
}
